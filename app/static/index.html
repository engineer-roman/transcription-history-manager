<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcription History Manager</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <!-- Top Bar -->
    <header class="top-bar">
        <div class="container">
            <h1>Transcription History</h1>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Left Panel: Conversations List -->
        <aside class="conversations-panel">
            <!-- Search Box -->
            <div class="search-section">
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <input
                            type="text"
                            id="searchInput"
                            placeholder="Search transcriptions..."
                            class="search-input"
                        >
                        <button id="resetSearchBtn" class="btn-reset-search" title="Reset search">×</button>
                    </div>
                    <button id="searchBtn" class="btn btn-primary">Search</button>
                </div>
            </div>
            <!-- Date/Time Filter -->
            <div class="filter-section">
                <h3 class="filter-title">Filter by Date & Time</h3>
                <div class="filter-controls">
                    <div class="datetime-group">
                        <label for="startDateTime">From:</label>
                        <input type="datetime-local" id="startDateTime" class="datetime-input">
                    </div>
                    <div class="datetime-group">
                        <label for="endDateTime">To:</label>
                        <input type="datetime-local" id="endDateTime" class="datetime-input">
                    </div>
                    <div class="filter-actions">
                        <button id="applyFilterBtn" class="btn btn-primary btn-sm">Apply</button>
                        <button id="clearFilterBtn" class="btn btn-secondary btn-sm">Clear</button>
                    </div>
                </div>
            </div>
            <div id="conversationsList" class="conversations-list">
                <!-- Items will be loaded here dynamically -->
            </div>
        </aside>

        <!-- Right Panel: Conversation Details -->
        <main class="details-panel">
            <div id="conversationDetails" class="conversation-details">
                <div class="empty-state">
                    <p>Select a conversation to view details</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Conversation Detail Template -->
    <template id="conversationDetailTemplate">
        <div class="detail-header">
            <h2 class="conversation-title"></h2>
            <div class="version-selector">
                <label for="versionDropdown">Version:</label>
                <select id="versionDropdown" class="version-dropdown"></select>
            </div>
        </div>

        <!-- Audio Player -->
        <div class="audio-player">
            <audio id="audioElement" preload="metadata"></audio>
            <div class="player-controls">
                <button id="playPauseBtn" class="btn btn-icon">▶</button>
                <button id="backwardBtn" class="btn btn-icon btn-seek" title="Back 10s">
                    <span class="seek-icon">↶<sub>10</sub></span>
                </button>
                <button id="forwardBtn" class="btn btn-icon btn-seek" title="Forward 10s">
                    <span class="seek-icon">↷<sub>10</sub></span>
                </button>
                <div class="time-display">
                    <span id="currentTime">0:00</span> / <span id="totalTime">0:00</span>
                </div>
                <div class="speed-controls">
                    <label>Speed:</label>
                    <button class="speed-btn" data-speed="0.75">0.75x</button>
                    <button class="speed-btn active" data-speed="1">1x</button>
                    <button class="speed-btn" data-speed="1.25">1.25x</button>
                    <button class="speed-btn" data-speed="1.5">1.5x</button>
                    <button class="speed-btn" data-speed="2">2x</button>
                </div>
            </div>
            <div class="timeline">
                <input
                    type="range"
                    id="timelineSlider"
                    class="timeline-slider"
                    min="0"
                    max="100"
                    value="0"
                >
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="raw">Raw Transcription</button>
            <button class="tab-btn" data-tab="timecodes">Timecodes</button>
            <button class="tab-btn" data-tab="llm">LLM Output</button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
            <div id="rawTab" class="tab-pane active">
                <div class="transcription-content"></div>
            </div>
            <div id="timecodesTab" class="tab-pane">
                <div class="timecodes-list"></div>
            </div>
            <div id="llmTab" class="tab-pane">
                <div class="llm-content-wrapper">
                    <button id="copyMarkdownBtn" class="btn-copy-markdown" title="Copy markdown">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M11 1H3C2.45 1 2 1.45 2 2V11H3V2H11V1ZM13 3H6C5.45 3 5 3.45 5 4V14C5 14.55 5.45 15 6 15H13C13.55 15 14 14.55 14 14V4C14 3.45 13.55 3 13 3ZM13 14H6V4H13V14Z" fill="currentColor"/>
                        </svg>
                        Copy
                    </button>
                    <div class="llm-content"></div>
                </div>
            </div>
        </div>
    </template>

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <!-- DOMPurify for sanitization -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <script src="/static/app.js"></script>
</body>
</html>
